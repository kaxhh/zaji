### 信号和中断

[TOC]

#### 前言

信号是==异步的进程间通讯机制==，是在软件层次上对中断机制的一种模拟。

#### 产生信号的条件

1. **用户在终端 按下某些键时**，终端驱动程序会发送信号给前台进程，例如Ctrl-C产生SIGINT信 号，Ctrl-/产生SIGQUIT信号，Ctrl-Z产生SIGTSTP信号。
2. **硬件异常产生信号**，这些条件由硬件检测到并通知内核，然后内核向当前进程发送适当的信号。例如当前进程执行了 除以0的指令，CPU的运算单元会产生异常，内核将这个异常解释为SIGFPE信号发送给进 程。再比如当前进程访问了非法内存地址，MMU会产生异常，内核将这个异常解释为SIGSEGV信 号发送给进程。
3. 一个**进程调用kill(2)函数**可以发送信 号给另一个进程。
4. 可以用kill(1)命令发送信号给某个 进程，kill(1)命令也是调用kill(2)函 数实现的，如果不明确指定信号则发送SIGTERM信号，该信号的默认处理动作是终止进程。
5. **当 内核检测到某种软件条件发生时也可以通过信号通知进程**，例如闹钟超时产生SIGALRM信 号，向读端已关闭的管道写数据时产生SIGPIPE信号。

![信号的捕捉](F:\gitHub\zaji\信号signal\pic\信号的捕捉.bmp)

异常和函数产生信号的方式，以及进程的处理过程：
![信号的处理](F:\gitHub\zaji\信号signal\pic\信号的处理.bmp)

#### 信号与中断的相似点

（1）采用了相同的异步通信方式；
（2）当检测出有信号或中断请求时，都暂停正在执行的程序而转去执行相应的处理程序；
（3）都在处理完毕后返回到原来的断点；
（4）对信号或中断都可进行屏蔽。

#### 信号与中断的区别

（1）中断有优先级，而信号没有优先级，所有的信号都是平等的；
（2）信号处理程序是在用户态下运行的，而中断处理程序是在核心态下运行；
（3）中断响应是及时的，而信号响应通常都有较大的时间延迟。

#### 信号机制

（1）发送信号。发送信号的程序用系统调用kill( )实现；
（2）预置对信号的处理方式。接收信号的程序用signal( )来实现对处理方式的预置；
（3）收受信号的进程按事先的规定完成对相应事件的处理。

#### 对信号的处理

当一个进程要进入或退出一个低优先级睡眠状态时，或一个进程即将从核心态返回用户态时，核心都要检查该进程是否已收到软中断。当进程处于核心态时，即使收到软中断也不予理睬；只有当它返回到用户态后，才处理软中断信号。对软中断信号的处理分三种情况进行：

（1）如果进程收到的软中断是一个已决定要忽略的信号（function=1），进程不做任何处理便立即返回；
（2）进程收到软中断后便退出（function=0）；
（3）执行用户设置的软中断处理程序。





